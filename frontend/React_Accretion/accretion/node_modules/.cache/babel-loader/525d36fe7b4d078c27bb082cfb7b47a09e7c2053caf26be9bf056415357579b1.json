{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nexport default async function AuthJWT() {\n  _s();\n  const [jwt, setJWT] = useState(JSON.parse(localStorage.getItem('jwt')));\n  const checkJWTaccess = async token => {\n    try {\n      const response = await fetch(\"http://localhost:8000/auth/users/\", {\n        method: 'GET',\n        headers: {\n          'Authorization': `JWT ${token}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (response.ok) {\n        console.log(\"JWT access token is valid\");\n        return true;\n      }\n      if (!response.ok) {\n        throw new Error(response.JSON());\n      }\n    } catch (error) {\n      console.log(\"JWT access token is invalid\");\n      console.log(error);\n      return false;\n    }\n  };\n  const checkJWTrefresh = async token => {\n    try {\n      const response = await fetch(\"localhost:8000/auth/jwt/refresh/\", {\n        method: \"POST\",\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(token)\n      });\n      if (response.ok) {\n        // update the JWT access token in local storage\n        setJWT(prevJWT => ({\n          ...prevJWT,\n          \"access\": response.access\n        }));\n        localStorage.setItem('jwt', JSON.stringify(jwt));\n        return true;\n      }\n      if (!response.ok) {\n        throw new Error(response.JSON());\n      }\n    } catch (error) {\n      console.log(\"JWT refresh token is invalid, login again\");\n      console.log(error);\n      return false;\n    }\n  };\n  if (jwt) {\n    /* use try catch for async function */\n    // useEffect(() => {\n    //     console.log(\"JWT found in local storage\");\n\n    //     const isAccessValid = checkJWTaccess(jwt.access);\n    //     if (!isAccessValid) {\n    //         const isRefreshValid = checkJWTrefresh(jwt.refresh);\n    //         if (!isRefreshValid) {\n    //             return false;\n    //         } else {\n    //             return true;\n    //         }\n    //     }\n    // },[]);\n\n    /* use then chain */\n    // useEffect(() => {\n    //     console.log(\"JWT found in local storage\");\n    //     checkJWTaccess(jwt.access)\n    //     .then((isAccessValid) => {\n    //         if (isAccessValid) {\n    //             return true;\n    //         }\n    //         if (!isAccessValid) {\n    //             checkJWTrefresh(jwt.refresh)\n    //             .then((isRefreshValid) => {\n    //                 if (!isRefreshValid) {\n    //                     return false;\n    //                 } else {\n    //                     return true;\n    //                 }\n    //             })\n    //         }\n    //     })\n    // },[]);\n\n    console.log(\"JWT found in local storage\");\n    checkJWTaccess(jwt.access).then(isAccessValid => {\n      if (isAccessValid) {\n        return true;\n      }\n      if (!isAccessValid) {\n        checkJWTrefresh(jwt.refresh).then(isRefreshValid => {\n          if (!isRefreshValid) {\n            return false;\n          } else {\n            return true;\n          }\n        });\n      }\n    });\n  } else {\n    console.log(\"JWT not found in local storage\");\n    return false;\n  }\n}\n_s(AuthJWT, \"tyHyyMREDk/6EczKDSkXM2zMN9M=\");\n_c = AuthJWT;\nvar _c;\n$RefreshReg$(_c, \"AuthJWT\");","map":{"version":3,"names":["useState","useEffect","AuthJWT","_s","jwt","setJWT","JSON","parse","localStorage","getItem","checkJWTaccess","token","response","fetch","method","headers","ok","console","log","Error","error","checkJWTrefresh","body","stringify","prevJWT","access","setItem","then","isAccessValid","refresh","isRefreshValid","_c","$RefreshReg$"],"sources":["/Users/yxni-mbp/Dropbox (Personal)/Startup/Accretion/Website/frontend/React_Accretion/accretion/src/user-auth/AuthJWT.js"],"sourcesContent":["import {useState, useEffect} from 'react';\n\nexport default async function AuthJWT() {\n    const [jwt, setJWT] = useState(JSON.parse(localStorage.getItem('jwt')));\n\n    const checkJWTaccess = async (token) => { \n        try {\n            const response = await fetch(\n                \"http://localhost:8000/auth/users/\", \n                {\n                    method: 'GET', \n                    headers: {\n                        'Authorization': `JWT ${token}`,\n                        'Content-Type': 'application/json'\n                }\n            })\n\n            if (response.ok) {\n                console.log(\"JWT access token is valid\");\n\n                return true; \n            }\n\n            if (!response.ok) {\n                throw new Error(response.JSON());\n            }\n        }\n        catch (error) {\n            console.log(\"JWT access token is invalid\");\n            console.log(error); \n\n            return false; \n        }\n    }\n\n    const checkJWTrefresh = async (token) => {\n        try{\n            const response = await fetch(\n                \"localhost:8000/auth/jwt/refresh/\",\n                {\n                    method: \"POST\", \n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify(token) \n                }\n            )\n            \n            if (response.ok) {\n                // update the JWT access token in local storage\n                setJWT((prevJWT) => ({ \n                    ...prevJWT, \n                    \"access\": response.access\n                }));\n                localStorage.setItem('jwt', JSON.stringify(jwt));\n    \n                return true; \n            }\n\n            if (!response.ok) {\n                throw new Error(response.JSON());\n            }\n            \n        } \n        catch (error){\n            console.log(\"JWT refresh token is invalid, login again\");\n            console.log(error); \n\n            return false; \n        }\n    }\n\n    if (jwt) { \n        /* use try catch for async function */\n        // useEffect(() => {\n        //     console.log(\"JWT found in local storage\");\n\n        //     const isAccessValid = checkJWTaccess(jwt.access);\n        //     if (!isAccessValid) {\n        //         const isRefreshValid = checkJWTrefresh(jwt.refresh);\n        //         if (!isRefreshValid) {\n        //             return false;\n        //         } else {\n        //             return true;\n        //         }\n        //     }\n        // },[]);\n\n        /* use then chain */\n        // useEffect(() => {\n        //     console.log(\"JWT found in local storage\");\n        //     checkJWTaccess(jwt.access)\n        //     .then((isAccessValid) => {\n        //         if (isAccessValid) {\n        //             return true;\n        //         }\n        //         if (!isAccessValid) {\n        //             checkJWTrefresh(jwt.refresh)\n        //             .then((isRefreshValid) => {\n        //                 if (!isRefreshValid) {\n        //                     return false;\n        //                 } else {\n        //                     return true;\n        //                 }\n        //             })\n        //         }\n        //     })\n        // },[]);\n\n        console.log(\"JWT found in local storage\");\n        checkJWTaccess(jwt.access)\n        .then((isAccessValid) => {\n            if (isAccessValid) {\n                return true;\n            }\n            if (!isAccessValid) {\n                checkJWTrefresh(jwt.refresh)\n                .then((isRefreshValid) => {\n                    if (!isRefreshValid) {\n                        return false;\n                    } else {\n                        return true;\n                    }\n                })\n            }\n        })\n\n    } else {\n        console.log(\"JWT not found in local storage\");\n\n        return false;\n    }\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}