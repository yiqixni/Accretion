{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nexport default function AuthJWT() {\n  _s();\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [jwt, setJWT] = useState(JSON.parse(localStorage.getItem('jwt')));\n  const checkJWTaccess = async token => {\n    try {\n      const response = await fetch(\"http://localhost:8000/auth/users/\", {\n        method: 'GET',\n        headers: {\n          'Authorization': `JWT ${token}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (!response.ok) {\n        throw new Error(response.JSON());\n      }\n      console.log(\"JWT access token is valid\");\n      return true;\n    } catch (error) {\n      console.log(\"JWT access token is invalid\");\n      console.log(error);\n      return false;\n    }\n  };\n  const checkJWTrefresh = async token => {\n    try {\n      const response = await fetch(\"localhost:8000/auth/jwt/refresh/\", {\n        method: \"POST\",\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(token)\n      });\n      if (!response.ok) {\n        throw new Error(response.JSON());\n      }\n      setJWT(prevJWT => ({\n        ...prevJWT,\n        \"access\": response.access\n      }));\n      return true;\n    } catch (error) {\n      console.log(\"JWT refresh token is invalid, login again\");\n      console.log(error);\n      return false;\n    }\n  };\n  if (jwt) {\n    useEffect(() => {\n      console.log(\"JWT found in local storage\");\n      const isAccessValid = checkJWTaccess(jwt.access);\n      if (!isAccessValid) {\n        const isRefreshValid = checkJWTrefresh(jwt.refresh);\n        if (!isRefreshValid) {\n          setIsAuthenticated(false);\n        } else {\n          setIsAuthenticated(true);\n        }\n      }\n    }, []);\n  }\n  return isAuthenticated;\n}\n_s(AuthJWT, \"JouVH93RPO+xe1OEUnn3z0WW684=\");\n_c = AuthJWT;\nvar _c;\n$RefreshReg$(_c, \"AuthJWT\");","map":{"version":3,"names":["useState","useEffect","AuthJWT","_s","isAuthenticated","setIsAuthenticated","jwt","setJWT","JSON","parse","localStorage","getItem","checkJWTaccess","token","response","fetch","method","headers","ok","Error","console","log","error","checkJWTrefresh","body","stringify","prevJWT","access","isAccessValid","isRefreshValid","refresh","_c","$RefreshReg$"],"sources":["/Users/yxni-mbp/Dropbox (Personal)/Startup/Accretion/Website/frontend/React_Accretion/accretion/src/user-auth/AuthJWT.js"],"sourcesContent":["import {useState, useEffect} from 'react';\n\nexport default function AuthJWT() {\n    \n    const [isAuthenticated, setIsAuthenticated] = useState(false);\n    const [jwt, setJWT] = useState(JSON.parse(localStorage.getItem('jwt')));\n\n    const checkJWTaccess = async (token) => { \n        try {\n            const response = await fetch(\n                \"http://localhost:8000/auth/users/\", \n                {\n                    method: 'GET', \n                    headers: {\n                        'Authorization': `JWT ${token}`,\n                        'Content-Type': 'application/json'\n                }\n            })\n\n            if (!response.ok) {\n                throw new Error(response.JSON());\n            }\n            \n            console.log(\"JWT access token is valid\");\n\n            return true;\n        }\n        catch (error) {\n            console.log(\"JWT access token is invalid\");\n            console.log(error); \n\n            return false; \n        }\n    }\n\n    const checkJWTrefresh = async (token) => {\n        try{\n            const response = await fetch(\n                \"localhost:8000/auth/jwt/refresh/\",\n                {\n                    method: \"POST\", \n                    headers: {\n                        'Content-Type': 'application/json'\n                    },\n                    body: JSON.stringify(token) \n                }\n            )\n\n            if (!response.ok) {\n                throw new Error(response.JSON());\n            }\n\n            setJWT((prevJWT) => ({\n                ...prevJWT, \n                \"access\": response.access\n            }));\n\n            return true; \n        } \n        catch (error){\n            console.log(\"JWT refresh token is invalid, login again\");\n            console.log(error); \n\n            return false; \n        }\n    }\n\n    if (jwt) { \n        useEffect(() => {\n            console.log(\"JWT found in local storage\");\n            const isAccessValid = checkJWTaccess(jwt.access);\n            if (!isAccessValid) {\n                const isRefreshValid = checkJWTrefresh(jwt.refresh);\n                if (!isRefreshValid) {\n                    setIsAuthenticated(false);\n                } else {\n                    setIsAuthenticated(true);\n                }\n            }\n        },[]);\n\n    }   \n\n    return isAuthenticated;\n}"],"mappings":";AAAA,SAAQA,QAAQ,EAAEC,SAAS,QAAO,OAAO;AAEzC,eAAe,SAASC,OAAOA,CAAA,EAAG;EAAAC,EAAA;EAE9B,MAAM,CAACC,eAAe,EAAEC,kBAAkB,CAAC,GAAGL,QAAQ,CAAC,KAAK,CAAC;EAC7D,MAAM,CAACM,GAAG,EAAEC,MAAM,CAAC,GAAGP,QAAQ,CAACQ,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;EAEvE,MAAMC,cAAc,GAAG,MAAOC,KAAK,IAAK;IACpC,IAAI;MACA,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CACxB,mCAAmC,EACnC;QACIC,MAAM,EAAE,KAAK;QACbC,OAAO,EAAE;UACL,eAAe,EAAG,OAAMJ,KAAM,EAAC;UAC/B,cAAc,EAAE;QACxB;MACJ,CAAC,CAAC;MAEF,IAAI,CAACC,QAAQ,CAACI,EAAE,EAAE;QACd,MAAM,IAAIC,KAAK,CAACL,QAAQ,CAACN,IAAI,CAAC,CAAC,CAAC;MACpC;MAEAY,OAAO,CAACC,GAAG,CAAC,2BAA2B,CAAC;MAExC,OAAO,IAAI;IACf,CAAC,CACD,OAAOC,KAAK,EAAE;MACVF,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAC;MAC1CD,OAAO,CAACC,GAAG,CAACC,KAAK,CAAC;MAElB,OAAO,KAAK;IAChB;EACJ,CAAC;EAED,MAAMC,eAAe,GAAG,MAAOV,KAAK,IAAK;IACrC,IAAG;MACC,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CACxB,kCAAkC,EAClC;QACIC,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UACL,cAAc,EAAE;QACpB,CAAC;QACDO,IAAI,EAAEhB,IAAI,CAACiB,SAAS,CAACZ,KAAK;MAC9B,CACJ,CAAC;MAED,IAAI,CAACC,QAAQ,CAACI,EAAE,EAAE;QACd,MAAM,IAAIC,KAAK,CAACL,QAAQ,CAACN,IAAI,CAAC,CAAC,CAAC;MACpC;MAEAD,MAAM,CAAEmB,OAAO,KAAM;QACjB,GAAGA,OAAO;QACV,QAAQ,EAAEZ,QAAQ,CAACa;MACvB,CAAC,CAAC,CAAC;MAEH,OAAO,IAAI;IACf,CAAC,CACD,OAAOL,KAAK,EAAC;MACTF,OAAO,CAACC,GAAG,CAAC,2CAA2C,CAAC;MACxDD,OAAO,CAACC,GAAG,CAACC,KAAK,CAAC;MAElB,OAAO,KAAK;IAChB;EACJ,CAAC;EAED,IAAIhB,GAAG,EAAE;IACLL,SAAS,CAAC,MAAM;MACZmB,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC;MACzC,MAAMO,aAAa,GAAGhB,cAAc,CAACN,GAAG,CAACqB,MAAM,CAAC;MAChD,IAAI,CAACC,aAAa,EAAE;QAChB,MAAMC,cAAc,GAAGN,eAAe,CAACjB,GAAG,CAACwB,OAAO,CAAC;QACnD,IAAI,CAACD,cAAc,EAAE;UACjBxB,kBAAkB,CAAC,KAAK,CAAC;QAC7B,CAAC,MAAM;UACHA,kBAAkB,CAAC,IAAI,CAAC;QAC5B;MACJ;IACJ,CAAC,EAAC,EAAE,CAAC;EAET;EAEA,OAAOD,eAAe;AAC1B;AAACD,EAAA,CAlFuBD,OAAO;AAAA6B,EAAA,GAAP7B,OAAO;AAAA,IAAA6B,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}